<%- csv_headers = [
    'date',
    'incident_number',
    'incident_type',
    'incident_call_type',
    'cas_event_number',
    'status',
    'address',
    'city',
    'state',
    'zip',
    'county',
    'lat',
    'lng',
    'narrative',
    'units_destroyed',
    'units_major',
    'units_minor',
    'units_affected',
    'num_people_injured',
    'num_people_hospitalized',
    'num_people_deceased',
    'num_adults',
    'num_children',
    'num_families',
    'assistance_given',
    'incident_verified',
    'dispatch_relayed',
    'responders_identified',
    'dat_on_scene',
    'dat_departed_scene',
    'responder_name_1',
    'responder_role_1',
    'responder_flex_1',
    'responder_name_2',
    'responder_role_2',
    'responder_flex_2',
    'responder_name_3',
    'responder_role_3',
    'responder_flex_3',
    'responder_name_4',
    'responder_role_4',
    'responder_flex_4',
    'responder_name_5',
    'responder_role_5',
    'responder_flex_5',
    'responder_name_6',
    'responder_role_6',
    'responder_flex_6',
    'responder_name_7',
    'responder_role_7',
    'responder_flex_7',
    'responder_name_8',
    'responder_role_8',
    'responder_flex_8',
    'responder_name_9',
    'responder_role_9',
    'responder_flex_9',
    'responder_name_10',
    'responder_role_10',
    'responder_flex_10'
] -%>
<%= CSV.generate_line csv_headers -%>
<%- built_out_collection.each do |resource| -%>
<%= CSV.generate_line([
  resource.date,
  resource.incident_number,
  resource.incident_type,
  resource.dat_incident.try(:incident_call_type),
  resource.cas_event_number,
  resource.status,
  resource.address,
  resource.city,
  resource.state,
  resource.zip,
  resource.county,
  resource.lat,
  resource.lng,
  resource.narrative,
  resource.dat_incident.try(:units_destroyed),
  resource.dat_incident.try(:units_major),
  resource.dat_incident.try(:units_minor),
  resource.dat_incident.try(:units_affected),
  resource.dat_incident.try(:num_people_injured),
  resource.dat_incident.try(:num_people_hospitalized),
  resource.dat_incident.try(:num_people_deceased),
  resource.num_adults,
  resource.num_children,
  resource.num_families,
  resource.cases.map(&:total_amount).compact.sum,
  resource.event_logs.select{|el| el.event == "incident_verified"}.first.try(:event_time),
  resource.event_logs.select{|el| el.event == "dispatch_relayed"}.first.try(:event_time),
  resource.event_logs.select{|el| el.event == "responders_identified"}.first.try(:event_time),
  resource.event_logs.select{|el| el.event == "dat_on_scene"}.first.try(:event_time),
  resource.event_logs.select{|el| el.event == "dat_departed_scene"}.first.try(:event_time),
  resource.all_responder_assignments[0].try(:person).try(:full_name),
  resource.all_responder_assignments[0].try(:role),
  resource.all_responder_assignments[0].try(:was_flex),
  resource.all_responder_assignments[1].try(:person).try(:full_name),
  resource.all_responder_assignments[1].try(:role),
  resource.all_responder_assignments[1].try(:was_flex),
  resource.all_responder_assignments[2].try(:person).try(:full_name),
  resource.all_responder_assignments[2].try(:role),
  resource.all_responder_assignments[2].try(:was_flex),
  resource.all_responder_assignments[3].try(:person).try(:full_name),
  resource.all_responder_assignments[3].try(:role),
  resource.all_responder_assignments[3].try(:was_flex),
  resource.all_responder_assignments[4].try(:person).try(:full_name),
  resource.all_responder_assignments[4].try(:role),
  resource.all_responder_assignments[4].try(:was_flex),
  resource.all_responder_assignments[5].try(:person).try(:full_name),
  resource.all_responder_assignments[5].try(:role),
  resource.all_responder_assignments[5].try(:was_flex),
  resource.all_responder_assignments[6].try(:person).try(:full_name),
  resource.all_responder_assignments[6].try(:role),
  resource.all_responder_assignments[6].try(:was_flex),
  resource.all_responder_assignments[7].try(:person).try(:full_name),
  resource.all_responder_assignments[7].try(:role),
  resource.all_responder_assignments[7].try(:was_flex),
  resource.all_responder_assignments[8].try(:person).try(:full_name),
  resource.all_responder_assignments[8].try(:role),
  resource.all_responder_assignments[8].try(:was_flex),
  resource.all_responder_assignments[9].try(:person).try(:full_name),
  resource.all_responder_assignments[9].try(:role),
  resource.all_responder_assignments[9].try(:was_flex)
]).html_safe -%>
<%- end -%>
